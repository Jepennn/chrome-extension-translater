# Popup is the window that appears when a user clicks on the extension icon. 

# Content script is the script that runs in the context of the page. Has access to the DOM of the page.

# Service worker is the script that runs in the background. Dont have any access to the DOM of the page.
but can access the chrome api. Can be used for API calls, event listeners, etc, storage, etc.

# Chrome storage is a way to store data in the browser. It is similar to local storage, but is scoped to the extension.



# Google har lanserat något som heter "Built in AI" som är en liten AI modell som är inbyggd i Chrome. Som kan köras på användarens hårdvara.


# There is some option to use the side panel instead of the popup for your extension.


  useEffect(() => {
    console.log("Nu är jag vaken och kan ta emot events");
    // Listen for custom events dispatched from content.tsx
    // This allows the content script to handle chrome.runtime.onMessage
    // while React handles the UI updates
    const handleTranslationRequest = async (
      event: CustomEvent<{
        text: string;
        sendResponse: (response?: { text?: string; error?: string }) => void;
      }>
    ) => {
      const { text, sendResponse } = event.detail;
      console.log("Translation request received in React:", text);

      try {
        setIsLoading(true);
        setError("");

        // Get selection coordinates for tooltip positioning
        const selection = window.getSelection();
        let position = { x: 0, y: 0 };

        if (selection && selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          const rect = range.getBoundingClientRect();
          position = {
            x: rect.left + rect.width / 2,
            y: rect.top - 10, // Position above the selection
          };
        }

        // Check translator availability
        const translatorCapabilities = await Translator.availability({
          sourceLanguage: "en",
          targetLanguage: "sv",
        });

        if (translatorCapabilities !== "available") {
          setError("Translator is not available for that language or your browser");
          setIsLoading(false);
          sendResponse({ error: "Translator not available" });
          return;
        }

        console.log("Translator capabilities:", translatorCapabilities);

        // Create translator and translate
        const translator = await Translator.create({
          sourceLanguage: "en",
          targetLanguage: "sv",
        });

        const translatedText = await translator.translate(text);
        console.log("Translated text:", translatedText);

        setTranslation({
          originalText: text,
          translatedText,
          position,
        });
        setIsLoading(false);
        sendResponse({ text: translatedText });
      } catch (error) {
        console.error("Translation error:", error);
        const errorMessage = error instanceof Error ? error.message : String(error);
        setError(errorMessage);
        setIsLoading(false);
        sendResponse({ error: errorMessage });
      }
    };

    // Add event listener for custom translation events
    const eventHandler = handleTranslationRequest as unknown as EventListener;
    window.addEventListener("translation-request", eventHandler);

    // Cleanup listener on unmount
    return () => {
      window.removeEventListener("translation-request", eventHandler);
    };
  }, []);